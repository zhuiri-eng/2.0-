# ğŸ” Paymaç­¾åæ ¡éªŒå¤±è´¥é—®é¢˜æ’æŸ¥

## âŒ é”™è¯¯ä¿¡æ¯
```
ç«™ç‚¹æç¤ºä¿¡æ¯
signç­¾åæ ¡éªŒå¤±è´¥!
```

## ğŸ” å¯èƒ½çš„é—®é¢˜åŸå› 

### 1. å‚æ•°åç§°é—®é¢˜
Paymaå¯èƒ½è¦æ±‚ç‰¹å®šçš„å‚æ•°åç§°ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ï¼š

**å½“å‰ä½¿ç”¨çš„å‚æ•°ï¼š**
- `pid` - å•†æˆ·ID
- `type` - æ”¯ä»˜æ–¹å¼
- `out_trade_no` - è®¢å•å·
- `notify_url` - å¼‚æ­¥é€šçŸ¥åœ°å€
- `return_url` - åŒæ­¥è¿”å›åœ°å€
- `name` - å•†å“åç§°
- `money` - é‡‘é¢
- `sign_type` - ç­¾åç±»å‹
- `sign` - ç­¾å

**å¯èƒ½çš„é—®é¢˜ï¼š**
- å‚æ•°åç§°å¯èƒ½åº”è¯¥æ˜¯ `trade_no` è€Œä¸æ˜¯ `out_trade_no`
- å‚æ•°åç§°å¯èƒ½åº”è¯¥æ˜¯ `amount` è€Œä¸æ˜¯ `money`
- å‚æ•°åç§°å¯èƒ½åº”è¯¥æ˜¯ `subject` è€Œä¸æ˜¯ `name`

### 2. å‚æ•°å€¼æ ¼å¼é—®é¢˜
- é‡‘é¢æ ¼å¼ï¼šå¯èƒ½éœ€è¦æ˜¯æ•´æ•°ï¼ˆåˆ†ï¼‰è€Œä¸æ˜¯å°æ•°ï¼ˆå…ƒï¼‰
- è®¢å•å·æ ¼å¼ï¼šå¯èƒ½éœ€è¦ç‰¹å®šæ ¼å¼
- æ—¶é—´æˆ³ï¼šå¯èƒ½éœ€è¦æ·»åŠ æ—¶é—´æˆ³å‚æ•°

### 3. ç­¾åç®—æ³•é—®é¢˜
- å‚æ•°æ’åºå¯èƒ½ä¸æ­£ç¡®
- ç­¾åå­—ç¬¦ä¸²æ‹¼æ¥å¯èƒ½æœ‰é—®é¢˜
- MD5ç®—æ³•å®ç°å¯èƒ½æœ‰é—®é¢˜

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®æ­£å‚æ•°åç§°
```javascript
// å°è¯•ä¸åŒçš„å‚æ•°åç§°ç»„åˆ
const paymentData = {
    pid: '145297917',
    type: 'alipay',
    trade_no: orderId,        // å°è¯• trade_no è€Œä¸æ˜¯ out_trade_no
    amount: amount,           // å°è¯• amount è€Œä¸æ˜¯ money
    subject: orderName,       // å°è¯• subject è€Œä¸æ˜¯ name
    notify_url: notifyUrl,
    return_url: returnUrl,
    sign_type: 'MD5'
};
```

### æ–¹æ¡ˆ2ï¼šä¿®æ­£é‡‘é¢æ ¼å¼
```javascript
// å°†é‡‘é¢è½¬æ¢ä¸ºåˆ†
const amountInCents = Math.round(parseFloat(amount) * 100);
const paymentData = {
    // ... å…¶ä»–å‚æ•°
    money: amountInCents.toString(),  // ä½¿ç”¨åˆ†ä¸ºå•ä½
    // æˆ–è€…
    amount: amountInCents.toString(),
};
```

### æ–¹æ¡ˆ3ï¼šæ·»åŠ æ—¶é—´æˆ³
```javascript
const paymentData = {
    // ... å…¶ä»–å‚æ•°
    timestamp: Math.floor(Date.now() / 1000).toString(),
};
```

### æ–¹æ¡ˆ4ï¼šä¿®æ­£ç­¾åç®—æ³•
```javascript
function generateSign(data) {
    // ç¡®ä¿å‚æ•°æŒ‰å­—æ¯é¡ºåºæ’åº
    const sortedKeys = Object.keys(data)
        .filter(key => key !== 'sign' && key !== 'sign_type')
        .sort();
    
    let signStr = '';
    sortedKeys.forEach(key => {
        if (data[key] !== '' && data[key] != null && data[key] !== undefined) {
            signStr += key + '=' + data[key] + '&';
        }
    });
    signStr += 'key=' + PAYMA_KEY;
    
    console.log('ç­¾åå­—ç¬¦ä¸²:', signStr); // è°ƒè¯•ç”¨
    return md5(signStr);
}
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åˆ›å»ºæµ‹è¯•é¡µé¢
åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•é¡µé¢ï¼Œå°è¯•ä¸åŒçš„å‚æ•°ç»„åˆï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <title>Paymaç­¾åæµ‹è¯•</title>
</head>
<body>
    <h1>Paymaç­¾åæµ‹è¯•</h1>
    <button onclick="testPayment()">æµ‹è¯•æ”¯ä»˜</button>
    <div id="result"></div>
    
    <script>
        function testPayment() {
            // æµ‹è¯•ä¸åŒçš„å‚æ•°ç»„åˆ
            const testCases = [
                {
                    name: "åŸå§‹å‚æ•°",
                    data: {
                        pid: '145297917',
                        type: 'alipay',
                        out_trade_no: 'TEST' + Date.now(),
                        name: 'æµ‹è¯•å•†å“',
                        money: '0.01',
                        sign_type: 'MD5'
                    }
                },
                {
                    name: "ä¿®æ­£å‚æ•°å",
                    data: {
                        pid: '145297917',
                        type: 'alipay',
                        trade_no: 'TEST' + Date.now(),
                        subject: 'æµ‹è¯•å•†å“',
                        amount: '1', // 1åˆ†é’±
                        sign_type: 'MD5'
                    }
                }
            ];
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    console.log(`æµ‹è¯• ${testCase.name}:`, testCase.data);
                    submitPayment(testCase.data);
                }, index * 2000);
            });
        }
        
        function submitPayment(data) {
            // ç”Ÿæˆç­¾å
            data.sign = generateSign(data);
            
            // æäº¤è¡¨å•
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://pay.payma.cn/submit.php';
            form.target = '_blank';
            
            Object.keys(data).forEach(key => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = data[key];
                form.appendChild(input);
            });
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
        }
    </script>
</body>
</html>
```

### 2. è”ç³»PaymaæŠ€æœ¯æ”¯æŒ
å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½ä¸è¡Œï¼Œå»ºè®®ï¼š
- æŸ¥çœ‹Paymaå®˜æ–¹APIæ–‡æ¡£
- è”ç³»PaymaæŠ€æœ¯æ”¯æŒ
- ç¡®è®¤æ­£ç¡®çš„å‚æ•°æ ¼å¼å’Œç­¾åç®—æ³•

### 3. ä½¿ç”¨Paymaæä¾›çš„SDK
å¦‚æœæœ‰å®˜æ–¹SDKï¼Œå»ºè®®ä½¿ç”¨å®˜æ–¹SDKè€Œä¸æ˜¯è‡ªå·±å®ç°ç­¾åç®—æ³•ã€‚

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æµ‹è¯•**ï¼šåˆ›å»ºæµ‹è¯•é¡µé¢ï¼Œå°è¯•ä¸åŒçš„å‚æ•°ç»„åˆ
2. **æŸ¥çœ‹æ–‡æ¡£**ï¼šæŸ¥æ‰¾Paymaçš„å®˜æ–¹APIæ–‡æ¡£
3. **è”ç³»æ”¯æŒ**ï¼šå¦‚æœé—®é¢˜æŒç»­ï¼Œè”ç³»PaymaæŠ€æœ¯æ”¯æŒ
4. **å¤‡ç”¨æ–¹æ¡ˆ**ï¼šè€ƒè™‘ä½¿ç”¨å…¶ä»–æ”¯ä»˜ç½‘å…³

## ğŸ”— ç›¸å…³èµ„æº

- Paymaå®˜æ–¹æ–‡æ¡£ï¼š[https://pay.payma.cn/](https://pay.payma.cn/)
- MD5ç®—æ³•éªŒè¯ï¼š[åœ¨çº¿MD5è®¡ç®—å™¨](https://www.md5hashgenerator.com/)
- æ”¯ä»˜APIæµ‹è¯•å·¥å…·ï¼š[Postman](https://www.postman.com/) 